<h1 align="center" >ğŸ‰Sec-Tools</h1>
<p align="center">
	<a href="https://github.com/jwt1399/Sec-Tools"><img alt="Sec-Tools" src="https://img.shields.io/github/stars/jwt1399/Sec-Tools.svg"></a>
	<a href="https://github.com/jwt1399/Sec-Tools"><img alt="Sec-Tools" src="https://img.shields.io/github/forks/jwt1399/Sec-Tools.svg"></a>
</p>
<p align="center"><span>å¦‚æœä½ è§‰å¾—æœ¬é¡¹ç›®è¿˜ä¸é”™çš„è¯ï¼Œè¯·ç»™ä¸€ä¸ªâ¤ï¸Starâ¤ï¸å§ï¼Œæ„Ÿè°¢æ„Ÿè°¢ğŸ¤</span></p>
<h5 align="center"> Gitee:https://gitee.com/jwt1399/Sec-Tools</h5>
<h4 align="center" >
	<a href="https://github.com/jwt1399/Sec-Tools#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D">é¡¹ç›®ä»‹ç» -</a>
	<a href="https://github.com/jwt1399/Sec-Tools#%E9%A1%B9%E7%9B%AE%E9%A6%96%E9%A1%B5">è¯¦ç»†ä»‹ç» -</a>
	<a href="https://github.com/jwt1399/Sec-Tools#%E7%89%88%E6%9C%AC%E5%8F%98%E6%9B%B4%E8%AE%B0%E5%BD%95">ç‰ˆæœ¬è®°å½• -</a>
	<a href="https://github.com/jwt1399/Sec-Tools#%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2">é¡¹ç›®éƒ¨ç½² -</a>
	<a href="https://github.com/jwt1399/Sec-Tools#to-do">TODO - </a>
	<a href="https://github.com/jwt1399/Sec-Tools#%E8%B5%9E%E5%8A%A9">èµåŠ©</a>
</h4>

## å£°æ˜ 
å› è¿‘æœŸå¤šäººååº”æœ‰äººå°†æ­¤é¡¹ç›®ä½œä¸ºå•†å“è¿›è¡Œå”®å–ï¼Œç‰¹ä½œå¦‚ä¸‹å£°æ˜ï¼ï¼ï¼
- 1.æœ¬é¡¹ç›®ç‰ˆæƒå½’æœ¬ä½œè€…æ‰€æœ‰ï¼Œæœªæˆæƒä¸èƒ½å•†ç”¨ï¼Œä¸èƒ½ä½œä¸ºç›ˆåˆ©ä½¿ç”¨ï¼›
- 2.æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ ï¼Œæµ‹è¯•ï¼Œäº¤æµä½¿ç”¨ï¼Œå‹¿ç”¨äºéæ³•ç”¨é€”ï¼›
- 3.æœªç»æœ¬ä½œè€…å…è®¸ä¸å¾—è½¬è½½æœ¬é¡¹ç›®å†…å®¹ï¼Œå¦åˆ™å°†è§†ä¸ºä¾µæƒï¼›
- 4.è½¬è½½æˆ–è€…å¼•ç”¨æœ¬é¡¹ç›®å†…å®¹è¯·æ³¨æ˜æ¥æºåŠä½œè€…ï¼Œå¦åˆ™å°†è§†ä¸ºä¾µæƒï¼›
- 5.è¯·ä½¿ç”¨è€…éµå®ˆã€Šä¸­åäººæ°‘å…±å’Œå›½ç½‘ç»œå®‰å…¨æ³•ã€‹ï¼Œå‹¿ç”¨äºéæˆæƒæµ‹è¯•ï¼Œå¦‚ä½œä»–ç”¨æ‰€æ‰¿å—çš„æ³•å¾‹è´£ä»»ä¸€æ¦‚ä¸ä½œè€…æ— å…³ï¼Œä¸‹è½½ä½¿ç”¨å³ä»£è¡¨ä½¿ç”¨è€…åŒæ„ä¸Šè¿°è§‚ç‚¹ï¼›
- 6.å¯¹äºä¸éµå®ˆæ­¤å£°æ˜æˆ–è€…å…¶ä»–è¿æ³•ä½¿ç”¨æœ¬é¡¹ç›®å†…å®¹è€…ï¼Œæœ¬äººä¾æ³•ä¿ç•™è¿½ç©¶æƒç­‰ã€‚

## ğŸŒ±é¡¹ç›®ä»‹ç»

### ç³»ç»Ÿç®€ä»‹

æœ¬é¡¹ç›®å‘½åä¸º**Sec-Tools**ï¼Œæ˜¯ä¸€æ¬¾åŸºäº **Python-Django** çš„**å¤šåŠŸèƒ½ Web åº”ç”¨æ¸—é€æµ‹è¯•ç³»ç»Ÿ**ï¼ŒåŒ…å«**æ¼æ´æ£€æµ‹ã€ç›®å½•è¯†åˆ«ã€ç«¯å£æ‰«æã€æŒ‡çº¹è¯†åˆ«ã€åŸŸåæ¢æµ‹ã€æ—ç«™æ¢æµ‹ã€ä¿¡æ¯æ³„éœ²æ£€æµ‹**ç­‰åŠŸèƒ½ã€‚


### é¡¹ç›®åŠŸèƒ½

![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210617154357.png)

æœ¬ç³»ç»Ÿé€šè¿‡`æ—ç«™æ¢æµ‹`å’Œ`åŸŸåæ¢æµ‹`åŠŸèƒ½å¯¹å¾…æ£€æµ‹ç½‘ç«™è¿›è¡Œèµ„äº§æ”¶é›†ï¼Œé€šè¿‡`ç«¯å£æ‰«æ`ã€`æŒ‡çº¹è¯†åˆ«`ã€`ç›®å½•è¯†åˆ«`å’Œ`ä¿¡æ¯æ³„éœ²æ£€æµ‹`åŠŸèƒ½å¯¹å¾…æ£€æµ‹ç½‘ç«™è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œé€šè¿‡æ”¶é›†çš„ä¿¡æ¯åˆ†æè¯„ä¼°ç½‘ç«™å­˜åœ¨å“ªäº›å®‰å…¨éšæ‚£ï¼Œç„¶åä½¿ç”¨`æ¼æ´æ£€æµ‹`åŠŸèƒ½æ­ç¤ºç½‘ç«™å­˜åœ¨çš„æ¼æ´ä»¥åŠå±å®³ç­‰çº§å¹¶ç»™å‡ºä¿®å¤å»ºè®®ã€‚é€šè¿‡è¿™ä¸€ç³»åˆ—çš„æ­¥éª¤ï¼Œå¯ä»¥å¯¹Webåº”ç”¨è¿›è¡Œå…¨é¢æ£€æµ‹ï¼Œä»è€Œå‘ç°ç½‘ç«™å­˜åœ¨çš„å®‰å…¨éšæ‚£ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥é’ˆå¯¹ç›¸åº”çš„ç½‘ç»œå¨èƒåšå‡ºåº”æ€¥å“åº”ï¼Œè¿›è€Œæå‡ç«™ç‚¹çš„å®‰å…¨æ€§ã€‚

###  ç›¸å…³æŠ€æœ¯


| åç§°     | Python    | Django    | SQLite     | ECharts   | Tabler    | Layer | Docsify    | SimpleUI     | Boostrap Table     |
| -------- | --------- | --------- | ---------- | --------- | --------- | -------------- | ---------- | ------------ | --------- |
| **ç‰ˆæœ¬** | **3.7.0** | **3.1.4** | **3.35.2** | **5.0.1** | **1.0.0** |  **3.2.0**   | **4.11.6** | **2021.1.1** | **1.18.2**  |


## é¡¹ç›®é¦–é¡µ


é¦–é¡µé‡‡ç”¨ ECharts å¯¹æ¼æ´æ‰«æçš„æ¼æ´ç­‰çº§ã€æŒ‡çº¹è¯†åˆ«ç»„ä»¶ã€å®‰å…¨å¯¼èˆªæ•°æ®åšäº†å¯è§†åŒ–å›¾è¡¨å±•ç¤ºï¼Œå›¾è¡¨çš„é£æ ¼æ²¡æœ‰ç»Ÿä¸€ï¼Œå‡‘åˆçœ‹å§ğŸ˜‚

![ä»ªè¡¨ç›˜é¡µ](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210618105902.png)

## èº«ä»½éªŒè¯

> æ–°ç”¨æˆ·æƒ³è¦ä½¿ç”¨ç³»ç»ŸåŠŸèƒ½å¿…é¡»è¦æ³¨å†Œç™»å½•ï¼Œæ¸¸å®¢åªèƒ½è®¿é—®éƒ¨åˆ†é¡µé¢ã€‚æœ¬ç³»ç»Ÿæœ‰æ™®é€šç”¨æˆ·å’Œè¶…çº§ç”¨æˆ·ã€‚æ™®é€šç”¨æˆ·å¯ä»¥ä½¿ç”¨æœ¬ç³»ç»Ÿçš„æ‰€æœ‰åŠŸèƒ½ï¼Œä½†æ˜¯ä¸èƒ½ç™»å½•åå°ç®¡ç†ç³»ç»Ÿã€‚è¶…çº§ç”¨æˆ·ä¸ä»…å¯ä»¥ä½¿ç”¨æ‰€ç”¨åŠŸèƒ½è¿˜å¯ä»¥ç™»å½•åå°ç®¡ç†ç³»ç»Ÿä¸­æ‰€æœ‰çš„ç”¨æˆ·æƒé™å’Œæ•°æ®ã€‚

 **è®¾è®¡æ€è·¯ï¼š** ç™»å½•å’Œæ³¨å†Œæ¨¡å—åœ¨ Django è‡ªå¸¦çš„è®¤è¯æ¨¡å—çš„åŸºç¡€ä¸Šè¿›è¡Œå®ç°ï¼Œå› æ­¤åœ¨`åå°-->ç”¨æˆ·ä¸æˆæƒ`å°±å¯å¯¹æ³¨å†Œç”¨æˆ·è¿›è¡Œæƒé™åˆ†é…å’Œç›¸åº”ç®¡ç†ã€‚æˆ‘ä»¬ä½¿ç”¨ Django è‡ªå¸¦çš„æ•°æ®åº“ SQLite æ¥å­˜æ”¾è´¦æˆ·ä¿¡æ¯ï¼Œé‡æ„äº†æ•°æ®åº“è¡¨`auth_user`è¡¨ï¼Œå¢åŠ äº†ç”¨æˆ·é‚®ç®±å­—æ®µï¼Œauth_user ä¸­å¯†ç å­—æ®µæ˜¯åŠ äº† salt çš„ sha256 å€¼å†ç»è¿‡ base64 ç¼–ç ä¹‹åçš„å€¼ï¼Œä¿éšœäº†ç”¨æˆ·çš„ä¿¡æ¯å®‰å…¨ã€‚

| ç™»å½•é¡µ                                                       |  ![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210421020945.png)                                                      |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| æ³¨å†Œé¡µ | ![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210421001457.png) |

é‡è®¾å¯†ç åŠŸèƒ½è°ƒç”¨ç¬¬ä¸‰æ–¹åŒ… `django-password-reset` è¿›è¡Œå®ç°

| æ­¥éª¤ä¸€                                                       |   ![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210421020757.png)                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| æ­¥éª¤äºŒ | ![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210421020803.png) |

## æ¼æ´æ£€æµ‹

> è¯¥æ¨¡å—ä¸»è¦æ˜¯å¯¹ç›®æ ‡Webç³»ç»Ÿè¿›è¡Œå®‰å…¨æ¼æ´æ‰«æï¼ŒåŒ…æ‹¬SQLæ³¨å…¥ã€è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ã€å¼±å¯†ç ã€ä¸­é—´ä»¶æ¼æ´ã€‚ä¸­é—´ä»¶æ¼æ´æ‰«æåŒ…æ‹¬å¯¹Weblogicã€Struts2ã€Tomcat ã€Jbossã€Drupalã€Nexusçš„å·²çŸ¥æ¼æ´è¿›è¡Œæ£€æµ‹ï¼Œç”¨æˆ·æä¾›ç›®æ ‡URLå¹¶é€‰æ‹©CVEæ¼æ´ç¼–å·ã€‚

###  è®¾è®¡æ€è·¯

è¯¥æ¨¡å—çš„å…¨æ‰«æã€SQLæ³¨å…¥æ¼æ´æ‰«æã€XSSæ¼æ´æ‰«æã€å¼±å£ä»¤æ‰«æã€ä»…çˆ¬å–æ˜¯è°ƒç”¨ AWVS API è¿›è¡Œå®ç°ã€‚ä¸­é—´ä»¶æ¼æ´æ‰«ææ˜¯åŸºäºè„šæœ¬æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚å®ç°ã€‚æ ¹æ®æ¼æ´å½¢æˆçš„åŸå› ï¼Œç”Ÿæˆä¸€äº›æµ‹è¯• payload å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿï¼Œå†ç”±è¿”å›çš„çŠ¶æ€ç å’Œæ•°æ®æ¥åˆ¤æ–­payloadæ˜¯å¦æœ‰æ•ˆã€‚

### å®ç°æ•ˆæœ

![æ¼æ´æ‰«æ](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210617161157.png)

ç‚¹å‡»æ‰«æç›®æ ‡è·³è½¬åˆ°æ¼æ´ç»“æœé¡µï¼š

![æ¼æ´ç»“æœ](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210619102157.png)

å†ç‚¹å‡»æ‰«æç›®æ ‡çš„è·³è½¬åˆ°æ¼æ´è¯¦æƒ…é¡µï¼š

![æ¼æ´è¯¦æƒ…](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210619102149.png)

### è¯¦ç»†å®ç°

#### æ·»åŠ æ‰«æç›®æ ‡

æ¼æ´æ‰«ææœ€å¼€å§‹çš„å·¥ä½œæ˜¯æ·»åŠ æ‰«æç›®æ ‡åˆ° AWVS çš„æ‰«æé˜Ÿåˆ—ä¸­ã€‚AWVS æä¾›äº†ä¸€ä¸ª API æ¥å£: `/api/v1/targets`ï¼Œä½¿ç”¨ POST è¯·æ±‚ï¼Œ POST è¯·æ±‚å‚æ•°ä¸ºï¼š`{"address":"XXXX.XXXX.XXXX","description":"xxxx","criticality":"10"}`ã€‚

å½“ç›®æ ‡æ·»åŠ æˆåŠŸåä¼šè¿”å›ä¸€ä¸ª target_id ï¼Œè¿™ä¸ªå€¼åœ¨æ‰€æœ‰æ‰«æä¸­æ˜¯å”¯ä¸€çš„ã€‚é€šè¿‡ target_id åˆ¤æ–­ç›®æ ‡æ˜¯å¦æ·»åŠ æˆåŠŸã€‚æ·»åŠ å®Œç›®æ ‡åå¹¶æ²¡æœ‰å¼€å§‹æ‰«æï¼Œéœ€è¦ä½¿ç”¨å¦ä¸€ä¸ª API æ¥å£ï¼š`/api/v1/scans`ï¼Œä½¿ç”¨ POST è¯·æ±‚ï¼Œä¼ å…¥åˆšåˆšæ·»åŠ ç›®æ ‡ç”Ÿæˆçš„ target_id å’Œç”¨æˆ·é€‰æ‹©çš„æ‰«æç±»å‹ï¼ŒPOST è¯·æ±‚å‚æ•°ä¸ºï¼š`{"target_id":"xxxxxxx","profile_id":"xxxxxxx"}`ã€‚å¼€å§‹æ‰«æå°†ä¼šè¿”å›çŠ¶æ€ç 200ã€‚

ä½¿ç”¨ Python çš„ç¬¬ä¸‰æ–¹åº“ requests æ¥å®ç° API æ¥å£è®¿é—®ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹:

```python
#Target: POSTè¯·æ±‚/api/v1/targets
try:
	#dataåŒ…å«ç›®æ ‡URLå’Œç±»å‹ï¼Œauth_headersåŒ…å«API_KEY
   	response = requests.post(targets_api, auth_headers, data, False)
result = response.json()
target_id = result.get('target_id')
   	return target_id
except Exception:
return None
#Scan: POSTè¯·æ±‚/api/v1/scans
try:
    response = requests.post(scan_api, data, auth_headers, False)
    status_code = 200
except Exception:
status_code = 404
return status_code
```

API æ¥å£å·²ç»å®ç°ï¼Œè¿˜éœ€è¦è·å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®ã€‚ç”±äºæœ¬ç³»ç»Ÿæ˜¯åŸºäº Django å®ç°çš„ï¼Œæ‰€ä»¥ä½¿ç”¨ HTML+JavaScript æä¾›ç”¨æˆ·ç•Œé¢å’Œæ¥å—å’Œå‘é€æ•°æ®åˆ°åç«¯ï¼Œåç«¯ä½¿ç”¨ Python å®ç°ã€‚é¦–å…ˆåœ¨ **urls.py** é‡Œé¢åŠ å…¥æ·»åŠ è®¿é—®è·¯å¾„

`path('vuln_scan', views.vuln_scan, name='vuln_scan')`

åœ¨ **views.py** ä¸­å®šä¹‰ `vuln_scan()` å‡½æ•°æ¥æ”¶å‰ç«¯çš„ç”¨æˆ·è¾“å…¥ï¼Œå¹¶è°ƒç”¨å·²ç»å†™å¥½çš„ API å‡½æ•°ã€‚ç”¨æˆ·è¾“å…¥çš„ url ä¸ºæ‰«æçš„ç›®æ ‡ï¼Œæ‰«æç±»å‹åŒ…æ‹¬SQLæ³¨å…¥ã€XSSæ¼æ´ã€å¼±å£ä»¤å’Œå…¨æ‰«æï¼Œå…¶ä¸­å…¨æ‰«æå°±æ˜¯æ‰«ææ‰€æœ‰ç±»å‹çš„æ¼æ´ï¼Œå¦‚æœæ·»åŠ æˆåŠŸåè¿”å›çš„ target_id ä¸æ˜¯ Noneï¼Œè¯´æ˜æ·»åŠ æˆåŠŸï¼Œå°±å¯ä»¥å¼€å§‹è°ƒç”¨å¼€å§‹æ‰«æçš„ APIï¼Œå¼€å§‹æ‰«æåè¿”å›çŠ¶æ€ç ï¼Œä¸º200åˆ™å¼€å§‹æ‰«æï¼Œè¿”å›æˆåŠŸå¦åˆ™è¿”å›å¤±è´¥ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

```python
@csrf_exempt
def vuln_scan(request):
    #é€šè¿‡POSTè¯·æ±‚è·å–ç”¨æˆ·è¾“å…¥çš„URLå’Œæ‰«æç±»å‹
    url = request.POST.get('ip')
    scan_type = request.POST.get('scan_type')
    t = Target(API_URL, API_KEY)
    #å°†ç›®æ ‡URLæ·»åŠ åˆ°æ‰«æé˜Ÿåˆ—ä¸­
    target_id = t.add(url)
    #å¦‚æœtarget_idä¸ä¸ºNone,åˆ™å¼€å§‹æ‰«æ
    if target_id is not None:
        s = Scan(API_URL, API_KEY)
        status_code = s.add(target_id, scan_type)
        if status_code == 200:
            return success()
    return error()
```

æœ€åä½¿ç”¨ JavaScript æ¥å®ç°å‘é€ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œé€‰æ‹©é€šè¿‡ POST æ–¹æ³•å‘é€æ•°æ®ï¼Œå¹¶åœ¨å‘é€ä¹‹å‰åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„åˆæ³•æ€§ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹:

```javascript
function get_scan_info(ip , scan_type) {
#ä½¿ç”¨POSTè¯·æ±‚å‘é€ç”¨æˆ·è¾“å…¥
        $.post('/vuln_scan', {
            ip: ip ,
            scan_type: scan_type
        }, function (data) {
            if (data.code !== 200) {
                ......
            } else {
                ...... 
            }
           ......});
    }
var domain = $('input[name=scan_url]').val();
#ä½¿ç”¨å¾ªç¯åˆ¤æ–­ç”¨æˆ·é€‰æ‹©çš„æ‰«æç±»å‹
for(var i=0; i<document.getElementsByName("scan_type").length; i++) {
    if (document.getElementsByName("scan_type")[i].checked) {
      var scan_type=document.getElementsByName("scan_type")[i].value;
    }
}
if(domain){
	get_scan_info(domain,scan_type)
}else{
	......
}
```

æ€»ä½“æ¥è¯´ï¼Œé€šè¿‡ä¸Šè¿°çš„ä»£ç å®ç°ï¼Œå®ç°äº†å°†ç”¨æˆ·è¾“å…¥é€šè¿‡ JavaScript ä¼ è¾“ç»™åå°ï¼Œåå°æ¥æ”¶æ•°æ®åå°†è°ƒç”¨ AWVS APIï¼Œç„¶å AWVS å¼€å§‹æ ¹æ®ç”¨æˆ·è¾“å…¥å¼€å§‹æ‰«æç›®æ ‡ URLï¼Œæ‰«æç»“æŸåå°†ç»“æœä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚å®ç°æ•ˆæœå¦‚ä¸‹ï¼š

![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210619104620.png)

#### è·å–æ‰«æç»“æœ

åœ¨ä¸Šä¸€å°èŠ‚ä¸­ï¼Œå°†ç›®æ ‡æ‰«æçš„ç»“æœä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¾—åˆ°æ‰€æœ‰çš„æ‰«æç›®æ ‡ï¼Œ`â€˜/api/v1/scansâ€˜`ï¼Œè¯·æ±‚æ–¹å¼ä¸º GETï¼Œè¯·æ±‚æˆåŠŸåä¼šè¿”å›æ‰€æœ‰æ‰«æç›®æ ‡çš„ä¿¡æ¯ï¼Œåˆ©ç”¨è¿™ä¸ª API å¯ä»¥å®ç°å±•ç¤ºæ‰€æœ‰æ‰«æç›®æ ‡ã€‚è¦å®ç°å±•ç¤ºæ¯ä¸ªæ‰«æç›®æ ‡çš„æ‰€æœ‰æ¼æ´çš„åŠŸèƒ½ï¼Œéœ€è¦æŒ‰ç…§ target_id æ¥åœ¨æ‰€æœ‰æ‰«æç›®æ ‡ä¸­æœç´¢ã€‚AWVS ä¹Ÿæä¾›äº†ç›¸åº”çš„ APIï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„ API ä¸ºï¼š`/api/v1/vulnerabilities`

`?q=severity:{int};criticality:{int};status:{string};cvss_score:{logicexpression};cvss_score:{logicexpression};target_id:{target_id};group_id:{group_id}`ã€‚è¯·æ±‚æ–¹å¼ä¸º GETã€‚åˆ©ç”¨ target_id æœç´¢æ¯ä¸ªæ‰«æç›®æ ‡ã€‚è¿™ä¹Ÿè§£å†³äº†æ¼æ´ç»†èŠ‚é¡µé¢çš„ URL é—®é¢˜ã€‚å½“ä½¿ç”¨ target_id æœç´¢æ‰«æç›®æ ‡æˆåŠŸæ—¶å°†ä¼šè¿”å›è¿™ä¸ªç›®æ ‡çš„æ‰€æœæ¼æ´ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿™ä¸ªç›®æ ‡åŒ…å«çš„æ¼æ´ä¸ªæ•°ã€æ¯ä¸ªæ¼æ´çš„å±é™©ç­‰çº§ã€æ‰«ææ—¶é—´ã€æ‰«æç±»å‹ã€æ‰«æçŠ¶æ€ç­‰ä¿¡æ¯ã€‚

å…·ä½“å®ç°æ­¥éª¤å’Œæ·»åŠ æ‰«æç›®æ ‡å¤§ä½“ç›¸ä¼¼ï¼Œé¦–å…ˆç¬¬ä¸€æ­¥ä½¿ç”¨ requests æ¥å®ç° API è¯·æ±‚ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

```python
#è·å–æ‰€æœ‰æ‰«æç›®æ ‡
response=requests.get(scan_api, self.auth_headers, False) 
scan_response=response.json().get('scans')
for scan in scan_response:
   scan['request_url'] = request_url
   scan_list.append(scan)
return scan_list
#æœç´¢çŠ¶æ€ä¸ºâ€œopenâ€œ,å¯¹åº”target_idçš„æ‰«æç›®æ ‡
vuln_search_api=f'{vuln_api}?q=status:{status};target_id:{target_id}'
try:
#ä½¿ç”¨getæ–¹å¼è¯·æ±‚
    response = requests.get(vuln_search_api, auth_headers, False)
#è¿”å›æœç´¢ç»“æœç›®æ ‡çš„æ‰€æœ‰æ¼æ´ä¿¡æ¯
    return response.text
except Exception:
    return None
```

åœ¨ **urls.py** ä¸­åŠ å…¥ç”¨æˆ·è®¿é—®çš„ url ï¼Œè¿™ä¸ªéœ€è¦æä¾›ä¸€ä¸ª target_id æ–¹ä¾¿åç»­åŠŸèƒ½çš„å®ç°ï¼Œå…ˆè·å–æ‰€æœ‰ç›®æ ‡çš„target_idï¼Œç„¶åä½¿ç”¨å¾ªç¯å°†æ‰€æœ‰ target_id åŠ å…¥åˆ° urlpatterns åˆ—è¡¨ä¸­ã€‚å› ä¸ºåœ¨ Django ä¸­ views å‡½æ•°é€šå¸¸åªèƒ½ä½¿ç”¨ä¸€ä¸ª request å‚æ•°ï¼Œç”±äºè¿™é‡Œéœ€è¦å°† target_id ä¼ å…¥åˆ° views å‡½æ•°ä¸­ï¼Œä½¿ç”¨æ­£åˆ™åŒ¹é…çš„ `â€œ(?P<target_id>.*)$â€` æ¥æ”¶ä¼ å…¥çš„ target_idï¼Œåœ¨ views é‡Œå¯¹åº”å‡½æ•°çš„ç¬¬äºŒä¸ªå½¢å‚åå¿…é¡»å’Œ `<>` é‡Œçš„å€¼ä¸€è‡´æ‰æœ‰æ•ˆã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

```python
path('vulnscan', views.vulnscan, name="vulnscan"),
for target_id in target_ids:
	  #ä½¿ç”¨æ­£åˆ™åŒ¹é…è·å–ç¬¬äºŒä¸ªå‚æ•°ï¼štaget_id
urlpatterns.append(url(r'^vuln_result/(?P<target_id>.*)$', views.vuln_result, name='vuln_result/'+target_id))
```

åœ¨ **views.py** é‡Œå®šä¹‰å‡½æ•° `vulnscan(request)` è·å–æ‰€æœ‰å¯¹åº”çš„ç›®æ ‡æ¼æ´ä¿¡æ¯ã€‚ä½¿ç”¨ API å¾—åˆ°è¿”å›çš„æ¼æ´å±é™©ç­‰çº§ã€æ‰«æç›®æ ‡URLã€æ¯ä¸ªæ¼æ´å”¯ä¸€æ ‡è¯†çš„ vuln_idã€æ‰«æç±»å‹ã€æ‰«æå¤„ç†æ—¶é—´ï¼ŒAPI è¿”å›çš„æ‰«æå¤„ç†æ—¶é—´ä¸æ˜¯æ ‡å‡†çš„æ—¶é—´æ ¼å¼ï¼Œä½¿ç”¨æ­£åˆ™åŒ¹é…çš„æ–¹å¼ï¼Œå°†å…¶è½¬æ¢ä¸º `â€œ%Y-%m-%d %H:%M:%Sâ€œ` çš„æ ¼å¼ï¼Œå†å®šä¹‰å‡½æ•° `vuln_result(request,target_id)`ï¼Œæ ¹æ® target_id è·å–æ‰«æç›®æ ‡ä¸­æ‰€æœ‰æ¼æ´ä¿¡æ¯ï¼ŒåŒ…æ‹¬å­˜åœ¨æ¼æ´çš„URLã€æ¼æ´ç±»å‹ã€çŠ¶æ€å’Œå¤„ç†æ—¶é—´ç­‰ä¿¡æ¯ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

```python
@login_required
def vuln_result(request, target_id):
    d = Vuln(API_URL, API_KEY)
    data = []
    vuln_details = json.loads(d.search(None,None, "open", target_id=str(target_id)))

    id = 1
    for target in vuln_details['vulnerabilities']:
        item={
            'id': id,
            'severity': target['severity'],
            'target': target['affects_url'],
            'vuln_id':target['vuln_id'],
            'vuln_name': target['vt_name'],
            'time': re.sub(r'T|\..*$', " ", target['last_seen'])
        }
        id += 1
        data.append(item)
    return render(request,'vuln-reslut.html',{'data': data})
```

åœ¨è¿™ä¸ªå­åŠŸèƒ½ä¸­ï¼Œå‰ç«¯çš„æ•°æ®å±•ç¤ºä½¿ç”¨çš„æ˜¯ Bootstrap Tableã€‚è¿™ä¸ªæ¨¡æ¿æœ‰å¾ˆå¤šå®ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¡¨æ ¼çš„æœç´¢åŠŸèƒ½ã€åˆ†é¡µå±•ç¤ºåŠŸèƒ½ç­‰ç­‰ï¼Œå¢åŠ äº†ç”¨æˆ·ä½“éªŒã€‚è¡¨æ ¼çš„æ•°æ®åœ¨ HTML ä¸­ä½¿ç”¨åŒèŠ±æ‹¬å·æ¥æ¥æ”¶ï¼Œåœ¨ **views.py** å‡½æ•°ä¸­è¿”å›çš„åˆ°ç›¸åº”çš„ HTML é¡µé¢æ—¶ï¼Œå°† data å­—å…¸ä¸€èµ·è¿”å›ã€‚è¿™æ ·çš„è¿”å›æ–¹å¼å¯ä»¥å°†ä½¿ç”¨å­—å…¸ä¸­çš„ key å€¼è·å–å¯¹åº”çš„ values å€¼ã€‚è¿˜å¯ä»¥æ˜¯ä½¿ç”¨ if-elseã€for ç­‰è¯­å¥æ¥åˆ†ç±»å±•ç¤ºæ•°æ®ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

```django
{% for item in data %}
â€¦â€¦â€¦â€¦â€¦
# è¿™ä¸ªåªå±•ç¤ºäº†æ‰«æç›®æ ‡åˆ—ï¼Œå…¶ä»–åˆ—ç±»ä¼¼ 
<a href="/vuln_detail/{{ item.vuln_id }}"> {{ item.target }}</a>
â€¦â€¦â€¦â€¦â€¦
{% endfor %}
```

æœ€åå®ç°çš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ ¹æ®æ¯ä¸ªæ‰«æçŠ¶æ€ä¸åŒæœ‰ä¸åŒçš„æ˜¾ç¤ºï¼Œä½¿ç”¨çº¢é»„è“ç»¿æ¥åˆ†ç±»é«˜å±ã€ä¸­å±ã€ä½å±ã€infoç­‰çº§çš„æ¼æ´ã€‚æœ€åå±•ç¤ºäº†æ‰«æçš„å¤„ç†æ—¶é—´ã€‚

![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210619110224.png)

è¡¨æ ¼ä¸­æ‰«æç›®æ ‡åˆ—å¯ä»¥ç‚¹å‡»è¿›å…¥æŸ¥çœ‹ç›®æ ‡çš„æ‰€æœ‰æ¼æ´ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå±•ç¤ºäº†ç‰¹å®šçš„æ‰«æç›®æ ‡æ¯ä¸ªæ¼æ´çš„å±é™©ç­‰çº§ã€å­˜åœ¨æ¼æ´çš„URLã€æ¼æ´çš„ç±»å‹ã€‚
![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210619102157.png)

#### è·å–æ¼æ´ç»†èŠ‚

åœ¨å®ç°æ¼æ´æ‰«æå’Œç»“æœå±•ç¤ºåï¼Œè¿˜éœ€è¦è·å–æ¯ä¸ªæ¼æ´çš„ç»†èŠ‚ã€‚åŒ…æ‹¬å¯¼è‡´æ¼æ´çš„è¯·æ±‚å‚æ•°ã€æµ‹è¯•çš„ payloadã€æ•°æ®è¯·æ±‚åŒ…ã€ç®€è¦çš„ä¿®å¤å»ºè®®ç­‰ç­‰ã€‚å› ä¸ºæ¯ä¸ªæ¼æ´ä¹Ÿå­˜åœ¨ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯† vuln_idï¼Œå¯ä»¥æ ¹æ®è¿™ä¸ªå€¼æŸ¥è¯¢æŒ‡å®šæ¼æ´çš„æ‰€æœ‰ä¿¡æ¯ã€‚ä½¿ç”¨çš„ API ä¸ºï¼š`/api/v1/vulnerabilities/{vuln_id}`ï¼Œè¯·æ±‚æ–¹å¼ä¸º GETã€‚

 åŒæ ·åœ°ï¼Œé¦–å…ˆä½¿ç”¨ requests æ¥å®ç° API çš„è°ƒç”¨ï¼Œä¼ å…¥ vuln_id æ¥æŸ¥è¯¢æŒ‡å®šæ¼æ´çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä»£ç å¦‚ä¸‹ï¼š

```python
#è·å–æŒ‡å®šæ¼æ´çš„ç›¸å…³ä¿¡æ¯
def get(self, vuln_id):
    vuln_get_api = f'{self.vuln_api}/{vuln_id}'
    try:
		#ä½¿ç”¨GETè¯·æ±‚å°†vuln_idä¼ ç»™APIï¼Œç»“æœä»¥jsonæ ¼å¼è¿”å›
        response = requests.get(vuln_get_api, auth_headers, False)
        return response.json()
    except Exception:
        return None
```

åœ¨ **urls.py** ä¸­æ·»åŠ æ¼æ´ç»†èŠ‚çš„ urlï¼Œè¿™é‡Œä¸ä¸Šä¸€èŠ‚å±•ç¤ºæ‰«æç›®æ ‡çš„æ‰€æœ‰æ¼æ´ç±»ä¼¼ï¼Œéƒ½ç”¨æ­£åˆ™åŒ¹é…çš„å½¢å¼æ¥æ”¶ **views.py**é‡Œå‡½æ•°çš„ç¬¬äºŒä¸ªå½¢å‚ï¼Œä½†æ˜¯è¿™é‡Œä¸åœ¨ä½¿ç”¨ target_id è€Œæ˜¯ä½¿ç”¨ vuln_idã€‚ä»£ç å¦‚ä¸‹ï¼š

```python
for vuln_id in vuln_ids:
	urlpatterns.append(url(r'^vuln_detail/(?P<vuln_id>.*)$', views.vuln_detail, name='vuln_detail/' + vuln_id))
```

åœ¨ **views.py** é‡Œé¢å®šä¹‰ `vuln_details(request,vuln_id)` å‡½æ•°ï¼Œæ ¹æ® vuln_id æŸ¥è¯¢æŒ‡å®šæ¼æ´çš„ç›¸å…³ä¿¡æ¯ã€‚è¯¥å‡½æ•°å°† API è¿”å›çš„å€¼ä¸­æœ‰ç”¨çš„ä¿¡æ¯æå–å‡ºæ¥åˆ°å­—å…¸ data é‡Œï¼Œè¿”å›ç»™ vuln-details.html é¡µé¢ï¼Œä½¿ç”¨ åŒèŠ±æ‹¬å· æ¥æ¥æ”¶è¯¥æ¼æ´çš„å—å½±å“çš„URLã€å¤„ç†æ—¶é—´ã€æ¼æ´ç±»å‹ã€æ¼æ´æµ‹è¯•å‚æ•°ã€æ•°æ®è¯·æ±‚åŒ…ã€ç®€è¦çš„ä¿®å¤å»ºè®®ç­‰ä¿¡æ¯ã€‚å®ç°æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

```python
@login_required
def vuln_detail(request,vuln_id):
    d = Vuln(API_URL,API_KEY)
    data = d.get(vuln_id)
    print(data)
    parameter_list = BeautifulSoup(data['details'], features="html.parser").findAll('span')
    request_list = BeautifulSoup(data['details'], features="html.parser").findAll('li')
    data_dict = {
        'affects_url': data['affects_url'],
        'last_seen': re.sub(r'T|\..*$', " ", data['last_seen']),
        'vt_name': data['vt_name'],
        'details': data['details'].replace("  ",'').replace('</p>',''),
        'request': data['request'],
        'recommendation': data['recommendation'].replace('<br/>','\n')
    }
    try:
        data_dict['parameter_name'] = parameter_list[0].contents[0]
        data_dict['parameter_data'] = parameter_list[1].contents[0]
    except:
        pass
    num = 1
    try:
        Str = ''
        for i in range(len(request_list)):
            Str += str(request_list[i].contents[0])+str(request_list[i].contents[1]).replace('<strong>', '').replace('</strong>', '')+'\n'
            num += 1
    except:
        pass
    data_dict['Tests_performed'] = Str
    data_dict['num'] = num
    data_dict['details'] = data_dict['details'].replace('class="bb-dark"','style="color: #ff0000"')
    return render(request, "vuln-detail.html", {'data': data_dict})
```
![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210619102149.png)

#### åŸºäºPOCéªŒè¯çš„ä¸­é—´ä»¶æ¼æ´æ‰«æ

> æœ¬ç³»ç»Ÿä½¿ç”¨POCè„šæœ¬å®ç°å¯¹ä¸€äº›ä¸­é—´ä»¶çš„æ¼æ´æ‰«æ[7]ï¼ŒåŒ…æ‹¬Weblogicã€Tomcatã€Drupalã€JBossã€Nexusã€Struts2ç­‰ç­‰ã€‚é€šè¿‡æ¯ä¸ªæ¼æ´çš„ç‰¹ç‚¹ï¼Œä½¿ç”¨Pythonç¼–å†™ä¸åŒçš„POCè„šæœ¬éªŒè¯ç›®æ ‡æ˜¯å¦å­˜åœ¨è¯¥æ¼æ´ã€‚

é¦–å…ˆè¿™é‡Œçš„ç”¨æˆ·ç•Œé¢å’ŒåŸºäºAWVSçš„æ¼æ´æ‰«æå…±ç”¨ï¼Œå•ç‹¬åŠ å…¥äº†ä¸­é—´ä»¶æ¼æ´CVEç¼–å·çš„é€‰æ‹©ã€‚ä½¿ç”¨JavaScriptå‘é€ç”¨æˆ·è¾“å…¥çš„æ•°æ®åˆ°åç«¯ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

```javascript
#ä½¿ç”¨POSTè¯·æ±‚æäº¤ç”¨æˆ·çš„è¾“å…¥
function get_Middleware_scan(ip , CVE_id) {
    $.post('/Middleware_scan', {
    ip: ip , #ç›®æ ‡URL
    CVE_id: CVE_id  #é€‰æ‹©çš„CVEç¼–å·
}, function (data) {
#å¤„ç†è¿”å›ç»“æœ
      â€¦â€¦â€¦
      â€¦â€¦â€¦}); 
}
```

å°†ç›®æ ‡æ·»åŠ åˆ°æ•°æ®åº“åï¼Œå†æŸ¥è¯¢æ•°æ®åº“å¼€å§‹æ‰«æï¼Œé€šè¿‡ ajax æ¥è®¿é—® start_Middleware_scan è°ƒç”¨å¼€å§‹æ‰«æçš„å‡½æ•°ï¼Œç”±äºæ‰«ææ—¶é—´å¯èƒ½ä¼šå¾ˆé•¿ï¼Œéœ€è¦è®¾ç½®è¶³å¤Ÿçš„ timeout æ¥ç­‰å¾…æ‰«æçš„ç»“æœè¿”å›ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

```javascript
$.ajax({
#ä½¿ç”¨POSTè¯·æ±‚å‘é€ç›®æ ‡URLå’ŒCVEç¼–å·ï¼Œè®¾ç½®è¶…æ—¶ä¸º1ç§’
    type: "POST",
    url: '/start_Middleware_scan',
    timeout: 10000,
    data: {
    ip: ip,
    CVE_id: CVE_id
    }
});
```

åœ¨ **urls.py** é‡ŒåŠ å…¥ä¸­é—´ä»¶æ¼æ´æ‰«æçš„è®¿é—®è·¯å¾„ï¼Œéœ€è¦åŠ å…¥ä¸¤ä¸ªè·¯å¾„ï¼š`â€™Middleware_scanâ€˜`ï¼Œ`â€˜start_Middleware_scanâ€™`ã€‚å‰è€…æ˜¯ç”¨æˆ·æ·»åŠ æ‰«æç›®æ ‡æ—¶çš„è·¯å¾„ï¼Œç”¨äºæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„ç›®æ ‡å’ŒCVEç¼–å·ä¹‹åå°†å…¶æ’å…¥æ•°æ®åº“ã€‚åè€…æ˜¯å°†ç›®æ ‡æ’å…¥æ•°æ®åº“ä¹‹åï¼Œé€šè¿‡æ—¶é—´æˆ³ã€çŠ¶æ€ã€ç›®æ ‡ URL ä»¥åŠ CVE ç¼–å·æŸ¥è¯¢å‡ºæ¥å¼€å§‹æ‰«æã€‚å½“æ‰«æç»“æŸæ—¶æ›´æ–°æ•°æ®åº“ä¸­å¯¹åº”æ‰«æç›®æ ‡çš„çŠ¶æ€ã€‚è¿™æ ·çš„è®¾è®¡å¯ä»¥å®æ—¶çš„çœ‹åˆ°æ‰«æçš„çŠ¶æ€ã€‚

æ•°æ®åº“ä½¿ç”¨çš„æ˜¯ Sqliteï¼Œåœ¨ **models.py** é‡Œåˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¡¨ Middleware_vuln ï¼Œå­—æ®µåŒ…æ‹¬IDã€ç›®æ ‡URLã€çŠ¶æ€ã€ç»“æœã€CVEç¼–å·ã€æ—¶é—´æˆ³ã€‚åœ¨ Django é‡Œå®šä¹‰è¿™ä¸ªç±»è¡¨ç¤ºæˆ‘ä»¬éœ€è¦åˆ›å»ºçš„æ•°æ®åº“ï¼Œåœ¨ modles.py é‡Œåˆ›å»ºå¥½ä¹‹åï¼Œä½¿ç”¨å‘½ä»¤`python manage.py makemigrations`æ¥è®°å½• modles.py çš„æ‰€æœ‰æ”¹åŠ¨ï¼Œå¹¶ä¸”å°†è¿™ä¸ªæ”¹åŠ¨è¿ç§»åˆ° migrations è¿™ä¸ªæ–‡ä»¶ä¸‹ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ä¾‹å¦‚ï¼š0001æ–‡ä»¶ï¼Œå¦‚æœä½ æ¥ä¸‹æ¥è¿˜è¦è¿›è¡Œæ”¹åŠ¨çš„è¯å¯èƒ½ç”Ÿæˆå°±æ˜¯å¦å¤–ä¸€ä¸ªæ–‡ä»¶ä¸ä¸€å®šéƒ½æ˜¯0001æ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªå‘½ä»¤å¹¶æ²¡æœ‰ä½œç”¨åˆ°æ•°æ®åº“ï¼Œå†ä½¿ç”¨å‘½ä»¤ `python manage.py migrate` å°†æ ¹æ®åˆšåˆšæ£€æµ‹åˆ°çš„æ”¹åŠ¨æ¥åˆ›å»ºæ•°æ®åº“è¡¨å’Œå­—æ®µå±æ€§ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

```python
class Middleware_vuln(models.Model):
#ç±»åä¸ºæ•°æ®åº“è¡¨åï¼Œå˜é‡åä¸ºå­—æ®µåï¼Œå­—æ®µå±æ€§å®šä¹‰å¦‚ä¸‹
	id = models.AutoField(primary_key=True)
	url = models.CharField(max_length=100, null=True)
	status = models.CharField(max_length=20, null=True)
	result = models.CharField(max_length=100, null=True)
	CVE_id = models.CharField(max_length=100, null=True)
	time = models.CharField(max_length=100, null=True, unique=True)

```

åœ¨æ·»åŠ ç›®æ ‡å’Œå¼€å§‹æ£€æµ‹çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æ’å…¥æ•°æ®åº“å’ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œè¿™é‡Œä½¿ç”¨ Django çš„å‡½æ•°æ¥å¤„ç†æ•°æ®åº“çš„å¢åˆ æŸ¥æ”¹ã€‚å¯¹äº Middleware_vule çš„æ’å…¥ä½¿ç”¨ `Middleware_vuln.objects.create(url, status, result, CVE_id, time)`ï¼Œæ›´æ–°ä½¿ç”¨ `Middleware_vuln.objects.filter(time).update(status, result)`ã€‚è¿˜éœ€è¦ä½¿ç”¨ try-except æ¥å¤„ç†å¼‚å¸¸æƒ…å†µå¹¶æ‰“å°å‡ºé”™ä¿¡æ¯ã€‚

```python
def insert_Middleware_data(url, CVE_id, Time, result=None, status="runing"):
    try:
        Middleware_vuln.objects.create(url=url, status=status, result=result, CVE_id=CVE_id, time=Time)
        print("insert success")
        return True
    except:
        print("data insert error")
        return False


def update_Middleware_data(url, CVE_id, Time, result):
    try:
        Middleware_vuln.objects.filter(url=url, status='runing', CVE_id=CVE_id, time=Time).update(status="completed", result=result)
        print("update success")
    except:
        print("data updata error")
```

 åœ¨**views.py**é‡Œå®šä¹‰ `Middleware_scan()` è·å–ç”¨æˆ·è¾“å…¥ï¼Œå¹¶æ’å…¥åˆ°æ•°æ®åº“ä¸­,å…¶ä¸­æ—¶é—´æˆ³ Time ä¸ºå…¨å±€å˜é‡ï¼Œä½œä¸ºåé¢å¼€å§‹æ‰«æéƒ¨åˆ†æŸ¥è¯¢æ•°æ®åº“çš„æ¡ä»¶ï¼Œåœ¨æ’å…¥æ•°æ®æˆåŠŸå°±è¿”å› success(),å¦ä¾§è¿”å› error()ï¼Œè¿™é‡Œè¿”å›çš„å‡½æ•°æ—¶è¿”å›çš„çŠ¶æ€ç ï¼Œsuccess()è¿”å›çš„æ˜¯200ï¼Œerror()è¿”å›404ï¼Œé€šè¿‡ä¸Šé¢ JavaScrip tæ¥æ”¶ååšå‡ºåˆ¤æ–­ï¼Œå¹¶å¼¹å‡ºç›¸åº”çš„æç¤ºæ¡†ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

```python
Time = 0.0
@csrf_exempt
@login_required
def Middleware_scan(request):
    #ä½¿ç”¨POSTè¯·æ±‚è·å–ç”¨æˆ·è¾“å…¥ï¼Œå¹¶å°†å…¶æ’å…¥æ•°æ®åº“ä¸­ã€‚
    #Timeä½œä¸ºå…¨å±€å˜é‡æ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œä½œä¸ºæŸ¥è¯¢ç›®æ ‡ä¿¡æ¯çš„æ¡ä»¶ã€‚
    global Time
    try:
        url= request.POST.get('ip')
        CVE_id = request.POST.get('CVE_id').replace('-',"_")
        Time = time.time()  # time.strftime("%Y-%m-%d %H:%M:%S", time.localtime(t))æ—¶é—´æˆ³è½¬æ—¥æœŸæ ¼å¼
        if insert_Middleware_data(url, CVE_id, Time):
            return success()
    except:
        return error()
```

åˆå®šä¹‰å‡½æ•° `start_Middleware_scan()`,å®ç°å°†æ•°æ®åº“ä¸­æ—¶é—´æˆ³ä¸º Timeï¼ŒçŠ¶æ€ä¸º run çš„ç›®æ ‡æŸ¥è¯¢å‡ºæ¥ï¼Œæ ¹æ® CVEç¼–å·è°ƒç”¨å¯¹åº”çš„ POC è„šæœ¬ã€‚æœ€åæ›´æ–°æ•°æ®åº“çš„æ‰«æç»“æœå’Œæ‰«æçŠ¶æ€ï¼Œç”±äºåœ¨ä¸Šä¸€æ­¥ä¸­å°†æ•°æ®æ’å…¥æ•°æ®åº“ä¸­å¯èƒ½ä¼šèŠ±è´¹ä¸€ç‚¹æ—¶é—´ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ sleep() ç­‰å¾…æ•°æ®æ’å…¥åå†è¿›è¡ŒæŸ¥è¯¢å·¥ä½œå’Œæ‰«æå·¥ä½œï¼Œä¿è¯ä¸é—æ¼æ‰«æç›®æ ‡ã€‚

```python
@csrf_exempt
@login_required
def start_Middleware_scan(request):
    try:
        url = request.POST.get('ip')
        ip, port = urlparse(url).netloc.split(':')
        CVE_id = request.POST.get('CVE_id').replace('-', "_")
        time.sleep(5) #ç­‰å¾…æ•°æ®æ’å…¥æˆåŠŸååœ¨æŸ¥è¯¢å‡ºæ¥æ‰«æ
        msg = Middleware_vuln.objects.filter(url=url, status='runing', CVE_id=CVE_id, time=Time)
        print(msg)
        #æ‰«ææ¡ç›®å¯èƒ½ä¸æ­¢ä¸€æ¡ï¼Œéœ€è¦ä½¿ç”¨å¾ªç¯æ¥æ‰«æ
        for target in msg:
            result = POC_Check(target.url, target.CVE_id)
            #å°†æ‰«æç»“æœå’ŒçŠ¶æ€æ›´æ–°
            update_Middleware_data(target.url, target.CVE_id, Time, result)
        return success()
    except:
        return error()
```

##  ç«¯å£æ‰«æ

> æœ¬ç³»ç»Ÿç«¯å£æ‰«æå½“ç”¨æˆ·æŒ‡å®šäº†ç›®æ ‡IPåœ°å€åï¼Œç³»ç»Ÿæ­£å¼å·¥ä½œï¼ŒIPä¼ å…¥åå°å¯¹ç›®æ ‡è¿›è¡Œæ‰«æï¼Œæ‰«æå®Œæˆåå°†å¼€æ”¾ç«¯å£å’Œå¯¹åº”æœåŠ¡æ˜¾ç¤ºåˆ°å‰ç«¯ç•Œé¢ä¸Šã€‚åœ¨â€œæŒ‰ç«¯å£åˆ†å¸ƒåˆ’åˆ†â€å’Œâ€œæŒ‰åè®®ç±»å‹åˆ’åˆ†â€ä¸¤ä¸ªæ ç›®ä¸­å¯¹ç«¯å£åˆ’åˆ†è¿›è¡Œè®²è§£ï¼Œä½¿ç”¨æˆ·å…äºæŸ¥è¯¢çš„ç¹çã€‚åŒæ—¶è¯¥æ¨¡å—è¿˜å°†å†…ç½®å¸¸è§ç«¯å£æŸ¥è¯¢è¡¨ï¼Œåœ¨æ­¤å¯è¿›è¡Œç«¯å£åŠå…¶å¯¹åº”æœåŠ¡å’ŒåŠŸèƒ½çš„ç›¸å…³æŸ¥è¯¢å’Œç­›é€‰ï¼Œé€šè¿‡è¿™ä¸€ç³»åˆ—åŠŸèƒ½ç”¨æˆ·èƒ½å¤Ÿæ›´åŠ æ¸…æ™°çš„è®¤è¯†åˆ°ç›®æ ‡ä¸»æœºå¼€æ”¾äº†å“ªäº›æœåŠ¡ï¼Œä»¥æ­¤æ¥åˆ†æå¯èƒ½å­˜åœ¨æ¼æ´çš„æœåŠ¡ã€‚

### è®¾è®¡æ€è·¯

æœ¬ç³»ç»Ÿç«¯å£æ‰«æçš„å®ç°æ–¹æ³•æ˜¯åˆ©ç”¨Pythonæä¾›çš„åº“å‡½æ•°Socketè¿›è¡Œè°ƒç”¨ï¼Œé€šè¿‡TCPä¸‰æ¬¡æ¡æ‰‹ä¸ç›®æ ‡è®¡ç®—æœºçš„ç«¯å£å»ºç«‹è¿æ¥ã€‚å½“å®Œæˆä¸€æ¬¡å®Œæ•´çš„ä¸‰æ¬¡æ¡æ‰‹æ—¶ï¼Œåˆ™å¯ä»¥æ¨æ–­å‡ºç«¯å£å’Œå¯¹åº”æœåŠ¡æ˜¯å¼€æ”¾çš„ï¼Œåä¹‹åˆ™æ²¡æœ‰å¼€æ”¾ï¼Œä¸ºäº†æé«˜äº†æ‰«æçš„æ•ˆç‡ï¼Œæœ¬ç³»ç»Ÿå¼•å…¥å¤šçº¿ç¨‹æ‰«ææœºåˆ¶ã€‚

### å®ç°æ•ˆæœ

![ç«¯å£æ‰«æ](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210619183819.png)

### è¯¦ç»†å®ç°

#### ç«¯å£æ‰«æ

é€šè¿‡ Python ç›´æ¥å®šä¹‰ socketï¼Œå°è¯•ä¸ç›®æ ‡ç«¯å£è¿›è¡Œè¿æ¥ã€‚æœ¬ç¨‹åºä¸­ä½¿ç”¨`sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM);`çš„æ–¹å¼è¿›è¡Œ TCP è¿æ¥ï¼Œè°ƒç”¨`sock.connect_ex((ip,port))`ï¼Œæ¥å°è¯•è¿æ¥ç«¯å£ï¼Œå¦‚æœç«¯å£å¼€æ”¾åˆ™è¿”å›0ï¼Œå¦åˆ™è¿”å›é”™è¯¯ä»£ç ã€‚ä½¿ç”¨tryè¯­å¥æ¥æ•è·å¼‚å¸¸ï¼Œå¦‚æœ socket è¿æ¥è¶…æ—¶ï¼Œåˆ™è¿”å›å¼‚å¸¸å¤„ç†ä¿¡æ¯ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

```python
def socket_scan(self, hosts):
    '''ç«¯å£æ‰«ææ ¸å¿ƒä»£ç '''
    global PROBE
    socket.setdefaulttimeout(1)
    ip, port = hosts.split(':')
    try:
        if len(self.port) < 25:
            # åˆ›å»ºå¥—æ¥å­—
            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            # TCP/IPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥
            result = sock.connect_ex((ip, int(port)))   
# è°ƒç”¨socket.connect_ex((ip, port))ï¼Œç«¯å£å¼€æ”¾è¿”å›0ï¼Œå¦åˆ™è¿”å›é”™è¯¯ä»£ç 
# å®ç°å’Œnmapçš„å…¨è¿æ¥æ‰«æç±»ä¼¼çš„åŠŸèƒ½ã€‚
            if result == 0:                     # æˆåŠŸå»ºç«‹TCPé“¾æ¥
                self.port.append(port)          # ç»“æœé›†ä¸­å¢åŠ ç«¯å£
                for i in PROBE:                 # é€šè¿‡HTTP1.1åˆºæ¢
                    sock.sendall(i.encode())    # å‘é€å®Œæ•´çš„TCPæ•°æ®åŒ…
                    response = sock.recv(256)   # æ¥å—æœ€å¤§256byte
                    sock.close()
                    if response:
                        break
                if response:
                    for pattern in SIGNS:
                        pattern = pattern.split(b'|')
                        if re.search(pattern[-1],response, re.IGNORECASE): 
# æ­£åˆ™åŒ¹é…bannerä¿¡æ¯ä¸å­—å…¸ä¸­çš„æœåŠ¡
                            proto = '{}:{}'.format(pattern[1].decode(), port)
                            self.out.append(proto)  # æ·»åŠ è‡³è¾“å‡ºç»“æœ
                            break
        else:
            self.num = 1
    except (socket.timeout, ConnectionResetError): # å¼‚å¸¸å¤„ç†
        pass
    except:
        pass

```

å¦‚æœè¿™æ ·å•çº¿ç¨‹ï¼ˆä¸²è¡Œï¼‰é˜»å¡è¿è¡Œï¼Œä¼šè€—è´¹å¤§é‡æ—¶é—´ï¼Œå› æ­¤ï¼Œé€šè¿‡å¹¶å‘çš„æ–¹å¼ï¼Œå¹¶å‘è¯·æ±‚ï¼Œæå‡æ‰«æé€Ÿåº¦ï¼Œé€šè¿‡å¯¹æ¯”æ‰«æ300ä¸ªç«¯å£å•çº¿ç¨‹éœ€è¦30så·¦å³ï¼Œå¤šçº¿ç¨‹ä»…éœ€10så·¦å³ã€‚

æœ¬ç«¯å£æ‰«æåŠŸèƒ½ä¸­é‡‡ç”¨äº†å¹¶å‘64æ¡çº¿ç¨‹æ¥è¿›è¡Œæ‰«æï¼Œå› æ­¤ï¼Œåœ¨å®šä¹‰runæ–¹æ³•æ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰«æçš„ä¸¤ä¸ªç«¯å£å·é—´å·®æ•°ä¸º64ï¼Œåœ¨ç¨‹åºä¸­ä½¿ç”¨ concurrent.futures æ¥å®ç°ã€‚concurrent.futures æ¨¡å—æä¾›äº†ä¸€ä¸ªé«˜æ°´å¹³çš„æ¥å£ç”¨äºå¼‚æ­¥æ‰§è¡Œè°ƒç”¨ã€‚å¼‚æ­¥æ‰§è¡Œå¯ä»¥ä½¿ç”¨çº¿ç¨‹å®ç°ï¼Œä½¿ç”¨ ThreadPoolExecutorï¼Œæˆ–è€…ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä½¿ç”¨ ProcessPoolExecutor å®ç°ã€‚ä¸¤è€…éƒ½å®ç°ç›¸åŒæ¥å£ï¼Œéƒ½æ˜¯ç”±æŠ½è±¡ Executor ç±»å®šä¹‰çš„ã€‚

```python
THREADNUM = 64  # çº¿ç¨‹æ•°
def run(self, ip):  #å¤šçº¿ç¨‹æ‰«æ
    hosts = []
    global PORTS, THREADNUM
    for i in PORTS:
        hosts.append('{}:{}'.format(ip, i))
    try:
        with concurrent.futures.ThreadPoolExecutor(
                max_workers=THREADNUM) as executor:
            executor.map(self.socket_scan, hosts)
    except EOFError:
        pass
```

#### ç«¯å£æŸ¥è¯¢è¡¨

ç«¯å£æŸ¥è¯¢è¡¨åŠŸèƒ½é€šè¿‡æ”¶é›†ç½‘ä¸Šç«¯å£ä¿¡æ¯å»ºç«‹ç«¯å£æŸ¥è¯¢åº“ï¼Œæ¶‰åŠåˆ°çš„ç«¯å£æ•°æ®æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼ŒåŒ…æ‹¬ç«¯å£IDã€ç«¯å£å·ã€ç«¯å£å¯¹åº”æœåŠ¡ã€ç«¯å£å¯¹åº”åè®®å’Œç«¯å£æ‰€å±çŠ¶æ€ã€‚ç«¯å£æŸ¥è¯¢è¡¨ç»“æ„å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚

| å­—æ®µå   | å­—æ®µç±»å‹    | å…è®¸ç©º    | æ˜¯å¦ä¸»é”® | å¤‡æ³¨         |
| -------- | ----------- | --------- | -------- | ------------ |
| id       | integer     | Not  null | True     | ç«¯å£ID       |
| num      | bigint      | Not  null | False    | ç«¯å£å·       |
| service  | text        | Not  null | False    | ç«¯å£å¯¹åº”æœåŠ¡ |
| protocol | Varchar(20) | Not  null | False    | ç«¯å£å¯¹åº”åè®® |
| status   | Varchar(10) | Not  null | False    | ç«¯å£æ‰€å±çŠ¶æ€ |

ç«¯å£æŸ¥è¯¢æ•°æ®åº“é‡‡ç”¨Django Modelè¿›è¡Œå»ºç«‹ï¼Œå­—æ®µåŒ…å«ç«¯å£å·ã€æœåŠ¡ã€åè®®ã€å’ŒçŠ¶æ€ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š

```python
class PortList(models.Model):
    '''ç«¯å£æŸ¥è¯¢è¡¨'''
    num=models.BigIntegerField(verbose_name='ç«¯å£å·')
    service=models.TextField(max_length=100,verbose_name='æœåŠ¡')
    protocol=models.CharField(max_length=20,verbose_name='
åè®®',blank=True,default='æœªçŸ¥')
    status=models.CharField(max_length=10,verbose_name='
çŠ¶æ€',blank=True,default='æœªçŸ¥')
    class Meta:  
	# åå°è¡¨å¤´è®¾ç½®
        verbose_name=verbose_name_plural='ç«¯å£åˆ—è¡¨'
```

æ•°æ®åº“å»ºç«‹åéœ€è¦è¿›è¡Œåå°æ³¨å†Œï¼Œè¿™æ ·å¯ä»¥è¿›å…¥åå°å¯¹æ•°æ®è¿›è¡Œç®¡ç†ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š

```python
@admin.register(PortList)
class PortListAdmin(ImportExportModelAdmin):
    # è®¾ç½®å“ªäº›å­—æ®µæ˜¾ç¤ºåœ¨åå°
    list_display = ('num', 'service', 'protocol', 'status',)
    # è®¾ç½®numå­—æ®µè¿›å…¥ç¼–è¾‘ç•Œé¢ 
    list_display_links = ('num',)  
    search_fields = ('num', 'service',)
    # è¿‡æ»¤å™¨ï¼ŒæŒ‰å­—æ®µè¿›è¡Œç­›é€‰
    list_filter = ('protocol','status')
    # è®¾ç½®numä¸ºé»˜è®¤æ’åºå­—æ®µ
    ordering = ('num', )
    list_per_page = 15  #è®¾ç½®æ¯é¡µæ˜¾ç¤ºæ•°æ®æ¡æ•°
```



## æŒ‡çº¹è¯†åˆ«

> è¯¥æ¨¡å—é‡‡ç”¨æå–æŒ‡çº¹ç‰¹å¾ç ç‰¹å¾ä¿¡æ¯æ¥è¯†åˆ«WebæŒ‡çº¹ï¼Œç³»ç»Ÿé€šè¿‡æ„é€ å¤§é‡ç‰¹æ®Šçš„HTTPè¯·æ±‚ä¸WebæœåŠ¡å™¨äº¤äº’ï¼Œä»å…¶å“åº”æ•°æ®åŒ…ä¿¡æ¯ä¸­æå–æå–æŒ‡çº¹ç‰¹å¾ä¿¡æ¯ï¼Œç„¶åé€šè¿‡ä¸æŒ‡çº¹æ•°æ®åº“è¿›è¡Œæ¯”å¯¹ï¼Œä»è€Œè·å–åˆ°WebæœåŠ¡å™¨åŠåº”ç”¨çš„ç»„ä»¶ä¿¡æ¯å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚é€šè¿‡å‘ç°è¿™äº›ç‰¹å¾ä¿¡æ¯å¹¶å¯¹å®ƒè¿›è¡Œè¯†åˆ«å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåœ°åˆ¶å®šæ¸—é€ç­–ç•¥ï¼Œæ˜¯æ¸—é€ç¯èŠ‚ä¸­å…³é”®çš„ä¸€æ­¥ã€‚

### è®¾è®¡æ€è·¯

å›½å†…å¤–å¯¹WebæœåŠ¡å™¨åŠåº”ç”¨æŒ‡çº¹çš„ç ”ç©¶ï¼Œä¸»è¦éƒ½æ˜¯é€šè¿‡æ„é€ å¤§é‡ç‰¹æ®Šçš„HTTPè¯·æ±‚ä¸WebæœåŠ¡å™¨äº¤äº’ï¼Œä»å…¶å“åº”æ•°æ®åŒ…ä¿¡æ¯ä¸­æå–æå–æŒ‡çº¹ç‰¹å¾ä¿¡æ¯ï¼Œç„¶åé€šè¿‡ä¸æŒ‡çº¹æ•°æ®åº“è¿›è¡Œæ¯”å¯¹ï¼Œä»è€Œè·å–åˆ°WebæœåŠ¡å™¨åŠåº”ç”¨çš„ç»„ä»¶ä¿¡æ¯å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚æœ¬æ–‡é‡‡ç”¨åŸºäºå…³é”®å­—ç‰¹å¾åŒ¹é…çš„æ–¹æ³•å®ç°æŒ‡çº¹è¯†åˆ«åŠŸèƒ½ï¼Œä¸ºäº†ä½¿æ£€æµ‹ç»“æœæ›´åŠ å‡†ç¡®ï¼Œå¯¹æ¯”ç½‘ä¸Šä¸€äº›ä¸»æµçš„æŒ‡çº¹æ•°æ®åº“ï¼Œå¯¹æœ¬ç³»ç»Ÿçš„æ•°æ®åº“è¿›è¡Œäº†ä¸€ç³»åˆ—ä¼˜åŒ–ã€‚

### å®ç°æ•ˆæœ

![finger](https://jwt1399.top/images/%E6%AF%95%E8%AE%BE%E8%BF%9B%E7%A8%8B/finger.png)

### è¯¦ç»†å®ç°

æŒ‡çº¹è¯†åˆ«æµç¨‹ä¸­æœ€å…³é”®çš„å°±æ˜¯æå–æŒ‡çº¹ç‰¹å¾è¿™ä¸€æ­¥éª¤ã€‚æå–æŒ‡çº¹ç‰¹å¾é¦–å…ˆéœ€è¦ç¡®å®šåº”è¯¥æå–å“åº”æ•°æ®æŠ¥æ–‡ä¸­çš„å“ªäº›æ•°æ®ã€‚å› æ­¤éœ€è¦è®¾è®¡ç‰¹å¾æå–ç®—æ³•å¯¹å“åº”æ•°æ®æŠ¥æ–‡è¿›è¡Œåˆ†æï¼Œå“åº”æ•°æ®åŒ…æ˜¯ç”±å“åº”è¡Œã€å“åº”å¤´ã€å“åº”ä½“ä¸‰éƒ¨åˆ†æ„æˆã€‚å“åº”è¡Œç”±HTTPç‰ˆæœ¬ã€çŠ¶æ€ç ã€çŠ¶æ€ç æè¿°æ„æˆã€‚å“åº”å¤´ç”¨äºæŒ‡ç¤ºå®¢æˆ·ç«¯å¦‚ä½•å¤„ç†å“åº”ä½“ï¼Œå“åº”å¤´é‡Œé¢åŒ…å«å¾ˆå¤šçš„ç»„ä»¶ä¿¡æ¯ï¼Œç”¨äºå‘Šè¯‰æµè§ˆå™¨å“åº”çš„ç±»å‹ã€å­—ç¬¦ç¼–ç æœåŠ¡å™¨ç±»å‹å’Œå­—èŠ‚å¤§å°ç­‰ä¿¡æ¯ã€‚å“åº”ä½“åˆ™æ˜¯æœåŠ¡å™¨æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚è¿”å›ç»™å®¢æˆ·ç«¯çš„å…·ä½“æ•°æ®ã€‚å“åº”å¤´å’Œå“åº”ä½“ä¸­åŒ…å«äº†èƒ½å¤Ÿè¯†åˆ«WebæŒ‡çº¹ç»„ä»¶çš„å­—æ®µå†…å®¹ï¼Œå› æ­¤ï¼Œå¯¹å“åº”å¤´å’Œå“åº”ä½“ä¸­å…³é”®å­—æ®µçš„æå–ï¼Œæ˜¯å®ç°æŒ‡çº¹è¯†åˆ«æŠ€æœ¯çš„æ ¸å¿ƒã€‚

æŒ‡çº¹è¯†åˆ«æŠ€æœ¯åˆ†ä¸ºä¿¡æ¯æ”¶é›†é˜¶æ®µå’ŒWebæŒ‡çº¹è¯†åˆ«é˜¶æ®µã€‚

(I)ä¿¡æ¯æ”¶é›†é˜¶æ®µ:é€šè¿‡ç”¨æˆ·è¾“å…¥çš„URLï¼Œæ”¶é›†Webåº”ç”¨çš„ç‰¹å®šå­—æ®µä¿¡æ¯ï¼Œè¿”å›é¡µé¢å…³é”®å­—æˆ–è€…ç‰¹æ®Šæ–‡ä»¶å’Œè·¯å¾„ç­‰è¿™äº›ç‰¹å¾ã€‚æ”¶é›†çš„å…³é”®æ•°æ®è¶Šå¤šå¯¹æ¥ä¸‹æ¥çš„æŒ‡çº¹è¯†åˆ«ç»“æœè¶Šå‡†ç¡®ã€‚

(2)WebæŒ‡çº¹è¯†åˆ«é˜¶æ®µ:è¯¥é˜¶æ®µåŒ…å«ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯æŒ‡çº¹åº“çš„å»ºç«‹ï¼Œè¯¥éƒ¨åˆ†ä¸»è¦è´Ÿè´£ä»å·²çŸ¥çš„Webåº”ç”¨ç¨‹åºä¸­æ”¶é›†ç‰¹å¾ä¿¡æ¯ï¼Œå¹¶ä¸”å»ºç«‹æŒ‡çº¹ç‰¹å¾åº“ï¼›æœ¬æ–‡é€šè¿‡åˆ†æHTTPå“åº”æ•°æ®æŠ¥æ–‡ï¼Œè®¾è®¡äº†ç½‘ç«™æŒ‡çº¹çš„æå–è§„åˆ™ï¼Œé€šè¿‡åˆ†æå“åº”å¤´å­—æ®µå’Œå“åº”ä½“å†…å®¹æ„å»ºäº†ä¸€ä¸ªæŒ‡çº¹ç»„ä»¶ä¿¡æ¯åº“ï¼Œä¿¡æ¯åº“é‡‡ç”¨JSONæ ¼å¼è¿›è¡Œå­˜å‚¨ã€‚æŒ‡çº¹ä¿¡æ¯æ˜¯ä»Wappalyzerå’ŒFOFAç­‰å¹³å°ä¸Šè¿›è¡Œæ”¶é›†å½’çº³çš„ã€‚å¦ä¸€éƒ¨åˆ†ä»å¾…æµ‹çš„Webåº”ç”¨ç¨‹åºä¸­æ”¶é›†ç‰¹å¾ä¿¡æ¯ï¼Œå¹¶ä¸æŒ‡çº¹ç‰¹å¾åº“ä¸­çš„æ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œä»è€Œè¯†åˆ«å‡ºå¾…æµ‹çš„webåº”ç”¨ç¨‹åºã€‚

## ç›®å½•æ‰«æ

> ç›®å½•è¯†åˆ«å‚ç…§dirsearchå®ç°ï¼ŒåŒ…å«phpã€aspã€jspç­‰ç½‘ç«™ç±»å‹è¿›è¡Œæ‰«æï¼Œè¿˜è®¾ç½®äº†é€’å½’æ‰«æå’Œè‡ªå®šä¹‰æ‰«æé€‰é¡¹ã€‚æ”¯æŒè‡ªå®šä¹‰å‰åç¼€æˆ–è€…å­ç›®å½•ã€‚

### è®¾è®¡æ€è·¯

Dirsearch æ‰«æçš„ç»“æœé€šè¿‡ JSONçš„æ ¼å¼ä¿å­˜åœ¨å¯¹åº”çš„è·¯å¾„ä¸‹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å‡è½»å¯¹æ•°æ®åº“çš„ä¾èµ–ã€‚è·å–çš„æ•°æ®è¢«åˆ†æˆ URL å’Œ TIMRï¼ŒURLä¸‹åˆåˆ†ä¸º content-lengthã€pathã€redirectã€staruså››ä¸ªéƒ¨åˆ†ã€‚å› ä¸ºåœ¨ JSON æ ¼å¼ä¸­è¢«ä¸åŒç±»å‹æ‹¬å·çš„æ•°æ®ä¼šè¢« Django è§£æä¸ºåˆ—è¡¨ã€å­—å…¸ç­‰æ ¼å¼ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹è·å¾—çš„ JSON æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå°†å…¶è½¬æ¢ä¸º Django å¯ä»¥è¯†åˆ«çš„æ•°æ®ï¼Œä½¿ä¹‹åœ¨å‰ç«¯è¿›è¡Œè¯»å–ã€‚

è¦æ­£ç¡®è§£ææ•°æ®ï¼Œéœ€è¦å…ˆç†è§£ Python æ•°æ®ç»“æ„å’Œ JSON æ•°æ®çš„è½¬æ¢æ–¹æ³•ã€‚æˆ‘ä»¬åŸºäºå½“å‰çš„å›ºå®šçš„ JSON æ ¼å¼å»è§£æå–å¾—çš„æ•°æ®ã€‚

### å®ç°æ•ˆæœ

![ç›®å½•è¯†åˆ«](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210303174736.png)



![ç›®å½•æ‰«æç»“æœ](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210619182009.png)

## ä¿¡æ¯æ³„éœ²

è¯¥æ¨¡å—ä¸»è¦ä¸ºç”¨æˆ·æä¾›å¸¸è§çš„ä¿¡æ¯æ³„éœ²æ£€æŸ¥ã€‚åœ¨å‰ç«¯ç›´è§‚çš„å±•ç¤ºåå°åœ°å€ã€é…ç½®æ–‡ä»¶ç­‰å¯èƒ½å­˜åœ¨æ³„éœ²çš„ä¿¡æ¯ï¼Œåœ¨ç»“æœåˆ—è¡¨ä¸­ï¼Œç”¨æˆ·å¯ä»¥éå¸¸æ¸…æ™°çš„çŸ¥é“æŸä¸ªWebæœåŠ¡å­˜åœ¨çš„ä¿¡æ¯æ³„éœ²é—®é¢˜ã€‚

![infoleak](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210620114317.png)

## æ—ç«™æ¢æµ‹

è¯¥æ¨¡å—ä¸»è¦å¯¹é€šè¿‡ IP åœ°å€ï¼Œç›´æ¥è·å–ä¸å½“å‰ IP æ‰€åœ¨æœåŠ¡å™¨ä¸Šçš„å…¶å®ƒç½‘ç«™ï¼Œ æœ¬æ¨¡å—ç›´æ¥è°ƒç”¨ api å®ç°

![æ—ç«™æ¢æµ‹](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210210100407.png)

## åŸŸåæ¢æµ‹

è¯¥æ¨¡å—ä¸»è¦é€šè¿‡è°ƒç”¨ api æ¥æ‰«æç½‘ç«™çš„å­åŸŸå

![åŸŸåæ¢æµ‹](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210620114025.png)

## å®‰å…¨å¯¼èˆª

å®‰å…¨å¯¼èˆªé¡µé¢çš„çµæ„Ÿæ¥è‡ªäº[Viggo](http://viggoz.com/)å¤§ä½¬å¼€å‘çš„[Webstack](http://webstack.cc/)é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ˜¯åŸºäºBootstrapå¼€å‘çš„çº¯å‰ç«¯é¡µé¢ï¼Œå› æ­¤å‰ç«¯æˆ‘æ²¿ç”¨äº†`Webstack` çš„é£æ ¼å¹¶èåˆäº†`Tabler UI `é£æ ¼ï¼Œå¹¶ç”¨ `Django `å†™äº†åå°ç®¡ç†ï¼Œå¯åœ¨çº¿å¯¹åˆ†ç±»å’Œæ¡ç›®è¿›è¡Œç®¡ç†ã€‚

### å‰ç«¯é¡µé¢

![å¯¼èˆªå‰ç«¯](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210421004925.png)

### åå°ç®¡ç†é¡µé¢

![å¯¼èˆªåå°](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210421005730.png)

### æ•°æ®åº“è®¾è®¡

![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210303172247.png)

#### å¯¼èˆªæ¡ç›®-Item

> æ ‡é¢˜title   æè¿°desc   ç½‘å€url   åˆ†ç±»category(å¤–é”®)   å›¾ç‰‡img    å›¾ç‰‡å®½åº¦img_width

```python
class Item(models.Model):
    '''å¯¼èˆªæ¡ç›®'''
    title = models.CharField(max_length=50,verbose_name='åç§°')
    desc = models.TextField(max_length=100,verbose_name='æè¿°')
    url = models.URLField(verbose_name='ç½‘å€',blank=True)
    img = models.URLField(default='https://jwt1399.top/favicon.png',verbose_name='logo')
    img_width = models.IntegerField(default=45, verbose_name='å›¾ç‰‡å®½åº¦')
    category = models.ForeignKey(Category, blank=True, null=True, verbose_name='åˆ†ç±»', on_delete=models.CASCADE)
    class Meta:
        verbose_name=verbose_name_plural='å¯¼èˆªæ¡ç›®'
    #åå°æ¡ç›®å›¾ç‰‡é¢„è§ˆ
    def img_admin(self):
        return format_html( '<img src="{}" width="50px" height="50px" style="border-radius: 50%;" />',self.img,)
    img_admin.short_description = 'logoé¢„è§ˆ'
    def __str__(self):
        return self.title
```

#### æ¡ç›®åˆ†ç±»-Category

> åç§°name   æ’åº sort   æ˜¯å¦æ·»åŠ åˆ°å¯¼èˆªæ add_menu   å›¾æ ‡icon

```python
class Category(models.Model):
    """æ¡ç›®åˆ†ç±»"""
    name = models.CharField(max_length=20, verbose_name='åç§°')
    sort = models.IntegerField(default=1, verbose_name='æ˜¾ç¤ºé¡ºåº')
    add_menu = models.BooleanField(default=True, verbose_name='æ·»åŠ åˆ°å¯¼èˆªæ ')
    icon = models.CharField(max_length=30, default='fas fa-home',verbose_name='å›¾æ ‡')
    class Meta:
        verbose_name_plural=verbose_name = 'åˆ†ç±»'

    #ç»Ÿè®¡åˆ†ç±»å¯¹åº”æ¡ç›®æ•°,å¹¶æ”¾å…¥åå°
    def get_items(self):
        return len(self.item_set.all())
    get_items.short_description = 'æ¡ç›®æ•°'  # è®¾ç½®åå°æ˜¾ç¤ºè¡¨å¤´
    #åå°å›¾æ ‡é¢„è§ˆ
    def icon_data(self):#å¼•å…¥Font Awesome Free 5.11.1
        return format_html('<h1><i class="{}"></i></h1>',self.icon) #è½¬åŒ–ä¸º<i class="{self.icon}"></i>
    icon_data.short_description = 'å›¾æ ‡é¢„è§ˆ'
    def __str__(self):
        return self.name
```

## æ–‡æ¡£é¡µ

å°† Docsify ç›´æ¥åµŒå…¥äº† Django ä¸­æ„é€ äº†æ–‡æ¡£é¡µã€‚

![æ–‡æ¡£é¡µ](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210620113024.png)

## å…¼å®¹æ€§

### Phoneç«¯

| ç«–å±                                                         | æ¨ªå±                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210620134517.png) | ![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210620134520.png) |

### Padç«¯

| ç«–å±                                                         | æ¨ªå±                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210620134523.png) | ![](https://cdn.jsdelivr.net/gh/jwt1399/cdn//img/20210620134527.png) |

## ç‰ˆæœ¬å˜æ›´è®°å½•

### v2.7ï¼ˆ2021-04-18ï¼‰

- æ–°å¢`åŸŸåæ¢æµ‹`åŠŸèƒ½ï¼›
- æ–°å¢`ä¸­é—´ä»¶æ¼æ´`æ‰«æï¼›
- ä¿®å¤`å¿˜è®°å¯†ç `åŠŸèƒ½ï¼›
- ä¼˜åŒ–AWVSæœªå¯åŠ¨æŠ¥é”™ä¿¡æ¯ï¼›
- ä¼˜åŒ–`ç”¨æˆ·ç™»å½•`é€»è¾‘ï¼›
- ä¼˜åŒ–`æ¼æ‰«è¯¦æƒ…`é¡µUIï¼›
- ä¼˜åŒ–å¯¼èˆªæ å¸ƒå±€ï¼›
- ä¼˜åŒ–è‹¥å¹²å°ç»†èŠ‚ï¼›

### v2.6ï¼ˆ2021-03-31ï¼‰

- æ–°å¢æ¼æ´`æ‰«æè¯¦æƒ…`åŠŸèƒ½ï¼›
- æ–°å¢é¦–é¡µ `ä»ªè¡¨ç›˜`ï¼›
- å®‰å…¨å¯¼èˆªé¡µå¯¼èˆªæ `ç§»åŠ¨ç«¯ä¼˜åŒ–`ï¼›
- å®‰å…¨å¯¼èˆªé¡µç›®å½•æ `ç¼©æ”¾ä¼˜åŒ–`ï¼›
- æ³¨å†Œ&ç™»å½•ç•Œé¢ä¼˜åŒ–ï¼›
- æ–‡æ¡£é¡µ`å¯¼èˆªæ ä¼˜åŒ–`ï¼›
- æ–°å¢ `UI` å¤œé—´æ¨¡å¼ï¼›
- ä¿®å¤è‹¥å¹²`UI` æ˜¾ç¤ºBugï¼›

### v2.5ï¼ˆ2021-03-02ï¼‰

- æ–°å¢äº†`æ¼æ´æ‰«æ`åŠŸèƒ½ï¼›
- ç«¯å£æ‰«æé¡µæ–°å¢`å¸¸è§ç«¯å£æŸ¥è¯¢è¡¨`ï¼›
- ä¿¡æ¯æ³„éœ²é¡µæ–°å¢`å¸¸è§ä¿¡æ¯æ³„éœ²åˆ—è¡¨`ï¼›
- æŒ‡çº¹è¯†åˆ«é¡µæ–°å¢`æ•°æ®åˆ†æ`å›¾è¡¨ï¼›
- æ¼æ´æ‰«æé¡µ`ç•Œé¢ä¼˜åŒ–`ï¼›

### v2.4ï¼ˆ2021-02-22ï¼‰

- æ–°å¢äº†`ç›®å½•è¯†åˆ«`åŠŸèƒ½ï¼›
- é‡å†™`æ¬¢è¿é¡µ`ï¼›
- å®‰å…¨å¯¼èˆªé¡µ`ç§»åŠ¨ç«¯ç•Œé¢`é€‚é…ï¼›
- å®‰å…¨å¯¼èˆªé¡µ`UIä¼˜åŒ–`ï¼›
- ç›®å½•è¯†åˆ«é¡µ`ç•Œé¢ä¼˜åŒ–`ï¼›
- æŒ‡çº¹è¯†åˆ«é¡µæ–°å¢`å¸¸è§æŒ‡çº¹`æ˜¾ç¤ºä¸æœç´¢ï¼›
- å¼•å…¥`Boostrap Table`å®ç°åˆ†é¡µï¼›
- æ·˜æ±° `LayUI` æ”¹ç”¨ `Layer` è¿›è¡Œå¼¹çª—ï¼›
- æ–‡æ¡£é¡µå¢åŠ `å¯¼èˆªæ `ï¼›

### v2.3ï¼ˆ2021-02-08ï¼‰

- å…¨æ–°çš„`é¡µé¢å¸ƒå±€`ï¼›
- UIé€‚é…`ç§»åŠ¨ç«¯`ï¼›
- ä¼˜åŒ–`å¯¼èˆªé¡µå¸ƒå±€`ï¼›
- ä¼˜åŒ–ä¸€ç³»åˆ—`UI`æ˜¾ç¤ºé—®é¢˜ï¼›
    - ä¼˜åŒ–äº†`æ‰‹æœºç«¯é¡µè„š`æ˜¾ç¤º
    - ä¼˜åŒ–äº†`å¹³æ¿ç«¯å¯¼èˆªæ¡`æ˜¾ç¤º
    - é¡µé¢åº•éƒ¨å¢åŠ `å›åˆ°é¡¶éƒ¨`æŒ‰é’®
    - æŒ‰é’®`è§¦å‘è·³è½¬`é¡µé¢ç›¸å¯¹ä½ç½®
    - `å›è½¦é”®`è§¦å‘æŸ¥è¯¢æŒ‰é’®
    - ä¼˜åŒ–`å¯¼èˆªé¡µé¡µè„š`æ˜¾ç¤º

### v2.2 ï¼ˆ2021-02-03ï¼‰

- æ–°å¢äº†`ä¿¡æ¯æ³„éœ²æ¢æµ‹`åŠŸèƒ½ï¼›
- æ–°å¢äº†`æ—ç«™æ¢æµ‹`åŠŸèƒ½ï¼›
- æ–°å¢äº†å¯¼èˆªé¡µ`æ•°æ®åˆ†æ`åŠŸèƒ½ï¼›
- æ–°å¢äº†åŸºäº`Docsify`çš„`æ–‡æ¡£é¡µ`ï¼›
- é‡æ„äº†`é™æ€æ–‡ä»¶static`æ–‡ä»¶ç»“æ„
- ä¼˜åŒ–äº†é¡¹ç›®`æ–‡ä»¶ç»“æ„`ï¼›
- ç¾åŒ–äº†`æ³¨å†Œ`é¡µé¢ï¼›
- å¼•å…¥äº†`åŠ¨æ€ç²’å­`èƒŒæ™¯æ•ˆæœï¼›
- ä¿®å¤äº†ä¸€äº› `UI` æ˜¾ç¤ºé—®é¢˜ï¼›

### v2.1 ï¼ˆ2021-01-13ï¼‰

- æ–°å¢äº†`æŒ‡çº¹è¯†åˆ«`åŠŸèƒ½ï¼›
- æ–°å¢äº†`ç™»å½•å’Œæ³¨å†ŒåŠŸèƒ½`åŠŸèƒ½ï¼›
- æ–°å¢äº†`æ¬¢è¿é¡µ`ï¼›
- ~~æ–°å¢äº†`æ–‡æ¡£é¡µ`ï¼›~~
- ä¿®å¤äº†ä¸€äº› `UI` æ˜¾ç¤ºé—®é¢˜ï¼›

### v2.0ï¼ˆ2021-01-04ï¼‰

- æ–°å¢äº†`ç«¯å£æ‰«æ`åŠŸèƒ½ï¼›
- æ–°å¢äº†`å®‰å…¨å¯¼èˆª`åŠŸèƒ½ï¼›
- è¿å…¥äº† `SQLite` æ•°æ®åº“ï¼Œåç»­è€ƒè™‘æ”¹ä¸º`MySQL`ï¼›
- ä¿®å¤äº†ä¸€äº› `UI` æ˜¾ç¤ºé—®é¢˜ï¼›
- ä¿®å¤äº†åå°å¤´éƒ¨å°å›¾æ ‡æ— æ³•æ˜¾ç¤ºé—®é¢˜ï¼›
- æ–°å¢äº†åå°æ•°æ®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ï¼›

### v1.0ï¼ˆ2020-12-20ï¼‰

- åŸºäº`Tabler`æ¡†æ¶æ„é€ äº†å‰ç«¯é¡µé¢ï¼›
- é‡‡ç”¨åŸºäº`Python`çš„ Django æ¡†æ¶ç¼–å†™åç«¯ï¼›
- å¼•å…¥äº†`SimpleUi`ç¾åŒ– Django åå°æ¡†æ¶ï¼›
- å¼•å…¥äº†`Font-Awsome 5.15.1`å›¾æ ‡ï¼›

## é¡¹ç›®éƒ¨ç½²

### æœ¬åœ°éƒ¨ç½²

1.ä½¿ç”¨ Pycharm æ‰“å¼€æœ¬é¡¹ç›®ï¼Œåœ¨ Pycharm çš„ `setting`--->`Project Interpreter`ä¸­ add ä¸€ä¸ªæ–°çš„è™šæ‹Ÿç¯å¢ƒã€‚

2.åœ¨è¯¥è™šæ‹Ÿç¯å¢ƒä¸‹æ‰“å¼€ Pycharm è‡ªå¸¦ Terminal è¿è¡Œ `pip install -r requirements.txt` ä¸‹è½½é¡¹ç›®æ‰€éœ€çš„ç¬¬ä¸‰æ–¹åŒ…ã€‚

3.ç°åœ¨é¡¹ç›®å·²ç»å¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œä½†æ˜¯æƒ³è¦ä½¿ç”¨æ¼æ´æ‰«æåŠŸèƒ½ï¼Œéœ€è¦å®‰è£…AWVSï¼Œå¹¶åœ¨é¡¹ç›®çš„`setting.py` ä¸­é…ç½® AWVSçš„ `API URL`å’Œ`API KEY`

4.å¿˜è®°å¯†ç åŠŸèƒ½ç›¸å…³é…ç½®åœ¨é¡¹ç›®çš„`setting.py` ä¸­ä¿®æ”¹

```python
EMAIL_HOST = 'smtp.163.com'
EMAIL_PORT = 25               # å‘ä»¶ç®±çš„smtpæœåŠ¡å™¨ç«¯å£
EMAIL_HOST_USER = 'xxx'       # ä½ çš„é‚®ç®±è´¦å·
EMAIL_HOST_PASSWORD ="xxx"    # é‚®ç®±æˆæƒç 
EMAIL_USE_TLS = True          # è¿™é‡Œå¿…é¡»æ˜¯ Trueï¼Œå¦åˆ™å‘é€ä¸æˆåŠŸ
EMAIL_FROM = 'xxx'            # ä½ çš„é‚®ç®±è´¦å·
DEFAULT_FROM_EMAIL = 'xxx'    # ä½ çš„é‚®ç®±è´¦å·
```

5.åˆ›å»ºè¶…çº§ç®¡ç†å‘˜ `python manage.py createsuperuser`

6.é»˜è®¤è´¦æˆ·ï¼šsectools/password..!!

### æœåŠ¡å™¨éƒ¨ç½²

è¯·å‚è€ƒï¼š[ä½¿ç”¨å®å¡”é¢æ¿å¿«é€Ÿéƒ¨ç½²Djangoé¡¹ç›®](https://www.django.cn/article/show-30.html)

## TO DO

> ä¸è®ºæ˜¯å¼€å‘è¿˜æ˜¯å®‰å…¨æ„Ÿè§‰éƒ½æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼Œè·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ï¼Œå…±å‹‰ ï¼

- [ ] å®‰å…¨å·¥å…·é¡µ
- [ ] å®‰å…¨å›¾ä¹¦é¡µ
- [ ] å¼•å…¥MySQLæ•°æ®åº“
- [ ] æ‰«æç®—æ³•ä¼˜åŒ–
- [ ] ä»£ç å˜é‡ã€æ•°æ®åº“ç»“æ„ä¼˜åŒ–
- [ ] æ¼æ´æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½
- [ ] é¡µé¢å¼‚æ­¥åˆ·æ–°

## é¡¹ç›®è´¡çŒ®è€…

- @Adam
- @xiafeng
- @lcyok


## èµåŠ©ğŸ’°

å¦‚æœä½ è§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä½ å¯ä»¥è¯·æˆ‘å–ä¸€æ¯å†°å¯ä¹ï¼å˜»å˜»ğŸ¤­

<table>
  <tbody>
     <tr>
         <td style="text-align:center;">æ”¯ä»˜å®æ”¯ä»˜</td>
         <td style="text-align:center;">å¾®ä¿¡æ”¯ä»˜</td>
     </tr>
   <tr>
    <td style="text-align:center;" ><img width="200" src="https://jwt1399.top/medias/reward/alipay.png"></td>    
      <td style="text-align:center;"><img width="200" src="https://jwt1399.top/medias/reward/wechat.png"></td>     
  </tr>
</tbody></table>
